name: Deploy Staging
on:
  push:
    branches:
      - develop

jobs:
  setup_env:
    uses: ./.github/workflows/setup-env.yml
    with:
      ENVIRONMENT: staging

  restart_services:
    needs: setup_env
    uses: ./.github/workflows/restart-services.yml
    with:
      ENVIRONMENT: staging
    secrets:
      SSH_HOST: ${{ secrets.SSH_HOST }}
      SSH_USERNAME: ${{ secrets.SSH_USERNAME }}
      SSH_PASSWORD: ${{ secrets.SSH_PASSWORD }}

  call-deploy-app:
    needs: restart_services
    uses: ./.github/workflows/deploy-app.yml
    with:
      # CONFIG_CHANGED: ${{ needs.restart_services.outputs.CHANGES == 'true' }}
      ENVIRONMENT: staging
